<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-au" lang="en-au">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.79.0" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>How Toddler plays &middot; congx.dev</title>
  <meta name="description" content="A closer look at how Tribal Wars 2 client and server communicates" />

  
  <link type="text/css" rel="stylesheet" href="https://congx.dev/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://congx.dev/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://congx.dev/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://congx.dev/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
</head>

  <body class="theme-base-navy ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://congx.dev/"><h1>congx.dev</h1></a>
      <p class="lead">
       An archive of things that are worth posting 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://congx.dev//readme">README</a> </li>
        <li><a href="https://github.com/rampadc/"> Github </a></li><li><a href="https://www.linkedin.com/in/cong-ng/"> LinkedIn </a></li><li><a href="https://www.twitter.com/congxdev/"> Twitter </a></li>
      </ul>
    </nav>

    <p>&copy; 2021. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>How Toddler plays</h1>
  <time datetime=2019-09-20T16:16:00&#43;1100 class="post-date">Fri, Sep 20, 2019</time>

  
  <span class="post-tags">
    
    #<a href="https://congx.dev/tags/toddler/">toddler</a>&nbsp;
    
  </span>
  
  
  <p>Back when I first started looking into making the manager (like 4 years ago), looking through Github&rsquo;s projects on automating Tribal Wars 2, I found most, if not all, of the projects relies on automating the browser instead of utilising the the game&rsquo;s WebSocket connection. Therefore, I think it&rsquo;s worthwhile to capture the essence of how the game client talks to the game server. Hopefully, this blog post may be helpful to those looking to automate this game.</p>
<p>When Tribal Wars 2 website is loaded, a websocket is connected using Socket.io 2.0.</p>
<p><img src="./socket-io-connection.png" alt="socketiO connection"></p>
<p>Messages sent between the game client (browser or mobile) and server includes metadata from Socket.io 2.0 library and looks something like the screenshot below. In the screenshot shown, green arrows denote messages sent to the server from the browser, and red arrows denote messages received from the server.</p>
<p><img src="./frames.png" alt="frames"></p>
<p>There are 3 types of messages that are sent between the game server and the client:</p>
<ul>
<li>Request/response messages. As an example, the highlighted line in the picture above is requesting for global world&rsquo;s information <code>GlobalInformation/getInfo</code>. The request has an <code>id</code> of 8. A few lines after this line, another message with <code>id</code> 8 is sent from the server to the client with type <code>GlobalInformation/info</code>. This is the response for the <code>get</code> request.</li>
<li>Fire-forget message from the client to the server. The most notable and only example of this is when the client requests server for future notifications.</li>
<li>Notifications from the server to the client. These messages are special in which the <code>id</code> of the message is <code>null</code>.</li>
</ul>
<p><img src="./message-types.png" alt="types"></p>
<p>The screenshot above shows the cleaned version of different types of messages. <code>42[&quot;msg&quot;</code>, portion and <code>&quot;headers&quot;</code> portion is removed from the message above.</p>
<p>You can visit this <a href="https://gist.github.com/rampadc/d719d60a2e359670808f862712bcb9ae">Gist</a> to look at what some captured messages look like, and <a href="https://gist.github.com/rampadc/6b76bc3c00d94d7ac2cfad9999de737b">examples of report JSONs</a>.</p>
<p>For a Javascript example of how the authentication sequence work, have a look at the <a href="https://github.com/rampadc/toddler-auth">toddler-auth</a> project.</p>

</div>


    </main>

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-35148726-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    
  </body>
</html>
