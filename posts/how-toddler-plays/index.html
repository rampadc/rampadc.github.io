<!DOCTYPE html>
<html><head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>How Toddler plays - Cong&#39;s little blog</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="How Toddler plays" />
<meta property="og:description" content="A closer look at how Tribal Wars 2 client and server communicates" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://congx.dev/posts/how-toddler-plays/" />
<meta property="article:published_time" content="2019-09-20T16:16:00+11:00" />
<meta property="article:modified_time" content="2019-09-20T16:16:00+11:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="How Toddler plays"/>
<meta name="twitter:description" content="A closer look at how Tribal Wars 2 client and server communicates"/>
<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
	<link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
	<link rel="stylesheet" type="text/css" media="screen" href="https://congx.dev/css/main.css" />
</head><body>
        <div class="content"><header>
	<div class="main">
		<a href="https://congx.dev/">Cong&#39;s little blog</a>
	</div>
	<nav>
		
		<a href="/readme">README</a>
		
		<a href="/posts/">All posts</a>
		
	</nav>
</header>

<main>
	<article>
		<div class="title">
			<h1 class="title">How Toddler plays</h1>
			<div class="meta">Posted on Sep 20, 2019</div>
		</div>
		

		<section class="body">
			<p>Back when I first started looking into making the manager (like 4 years ago), looking through Github&rsquo;s projects on automating Tribal Wars 2, I found most, if not all, of the projects relies on automating the browser instead of utilising the the game&rsquo;s WebSocket connection. Therefore, I think it&rsquo;s worthwhile to capture the essence of how the game client talks to the game server. Hopefully, this blog post may be helpful to those looking to automate this game.</p>

<p>When Tribal Wars 2 website is loaded, a websocket is connected using Socket.io 2.0.</p>

<p><img src="./socket-io-connection.png" alt="socketiO connection" /></p>

<p>Messages sent between the game client (browser or mobile) and server includes metadata from Socket.io 2.0 library and looks something like the screenshot below. In the screenshot shown, green arrows denote messages sent to the server from the browser, and red arrows denote messages received from the server.</p>

<p><img src="./frames.png" alt="frames" /></p>

<p>There are 3 types of messages that are sent between the game server and the client:</p>

<ul>
<li>Request/response messages. As an example, the highlighted line in the picture above is requesting for global world&rsquo;s information <code>GlobalInformation/getInfo</code>. The request has an <code>id</code> of 8. A few lines after this line, another message with <code>id</code> 8 is sent from the server to the client with type <code>GlobalInformation/info</code>. This is the response for the <code>get</code> request.</li>
<li>Fire-forget message from the client to the server. The most notable and only example of this is when the client requests server for future notifications.</li>
<li>Notifications from the server to the client. These messages are special in which the <code>id</code> of the message is <code>null</code>.</li>
</ul>

<p><img src="./message-types.png" alt="types" /></p>

<p>The screenshot above shows the cleaned version of different types of messages. <code>42[&quot;msg&quot;</code>, portion and <code>&quot;headers&quot;</code> portion is removed from the message above.</p>

<p>You can visit this <a href="https://gist.github.com/rampadc/d719d60a2e359670808f862712bcb9ae">Gist</a> to look at what some captured messages look like, and <a href="https://gist.github.com/rampadc/6b76bc3c00d94d7ac2cfad9999de737b">examples of report JSONs</a>.</p>

<p>For a Javascript example of how the authentication sequence work, have a look at the <a href="https://github.com/rampadc/toddler-auth">toddler-auth</a> project.</p>

		</section>

		<div class="post-tags">
			
			
			<nav class="nav tags">
				<ul class="tags">
					
					<li><a href="/tags/toddler">toddler</a></li>
					
				</ul>
			</nav>
			
			
		</div>
	</article>
</main>
<footer>
<hr><a class="soc" href="https://twitter.com/congxdev" title="GitHub"><i data-feather="github"></i></a>|<a class="soc" href="https://twitter.com/congxdev" title="Twitter"><i data-feather="twitter"></i></a>|<a class="soc" href="https://linkedin.com/in/cong-ng" title="LinkedIn"><i data-feather="linkedin"></i></a>|⚡️
	2020  <a href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
</footer>


<script>
      feather.replace()
</script>

</div>
    </body>
</html>
