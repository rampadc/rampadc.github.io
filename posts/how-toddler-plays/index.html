<!DOCTYPE html>
<html lang="en"><head>
    <title>CONGX.DEV</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no" />
    <meta name="theme-color" content="#000084" />
    <link rel="icon" href="https://congx.dev//favicon.ico">
    <link rel="canonical" href="https://congx.dev/">
    
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="stylesheet" href="/css/bootstrap-responsive.css">
    <link rel="stylesheet" href="/css/style.css">
    
</head><body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"></button>
            <a class="brand" href="https://congx.dev/">CONGX.DEV</a>
            <div class="nav-collapse collapse">
                <ul class="nav">
                    
                    
                        
                            <li>
                                <a href="/readme">
                                    
                                    <span>README</span>
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/posts/">
                                    
                                    <span>All posts</span>
                                </a>
                            </li>
                        
                    
                </ul>
            </div>
        </div>
    </div>
</nav><div id="content" class="container">

<div class="row-fluid navmargin">
    <div class="page-header">
        <h1>How Toddler plays - Fri, Sep 20, 2019</h1>
    </div>
    <p class="lead">A closer look at how Tribal Wars 2 client and server communicates</p>
    <p>Back when I first started looking into making the manager (like 4 years ago), looking through Github&rsquo;s projects on automating Tribal Wars 2, I found most, if not all, of the projects relies on automating the browser instead of utilising the the game&rsquo;s WebSocket connection. Therefore, I think it&rsquo;s worthwhile to capture the essence of how the game client talks to the game server. Hopefully, this blog post may be helpful to those looking to automate this game.</p>

<p>When Tribal Wars 2 website is loaded, a websocket is connected using Socket.io 2.0.</p>

<p><img src="./socket-io-connection.png" alt="socketiO connection" /></p>

<p>Messages sent between the game client (browser or mobile) and server includes metadata from Socket.io 2.0 library and looks something like the screenshot below. In the screenshot shown, green arrows denote messages sent to the server from the browser, and red arrows denote messages received from the server.</p>

<p><img src="./frames.png" alt="frames" /></p>

<p>There are 3 types of messages that are sent between the game server and the client:</p>

<ul>
<li>Request/response messages. As an example, the highlighted line in the picture above is requesting for global world&rsquo;s information <code>GlobalInformation/getInfo</code>. The request has an <code>id</code> of 8. A few lines after this line, another message with <code>id</code> 8 is sent from the server to the client with type <code>GlobalInformation/info</code>. This is the response for the <code>get</code> request.</li>
<li>Fire-forget message from the client to the server. The most notable and only example of this is when the client requests server for future notifications.</li>
<li>Notifications from the server to the client. These messages are special in which the <code>id</code> of the message is <code>null</code>.</li>
</ul>

<p><img src="./message-types.png" alt="types" /></p>

<p>The screenshot above shows the cleaned version of different types of messages. <code>42[&quot;msg&quot;</code>, portion and <code>&quot;headers&quot;</code> portion is removed from the message above.</p>

<p>You can visit this <a href="https://gist.github.com/rampadc/d719d60a2e359670808f862712bcb9ae">Gist</a> to look at what some captured messages look like, and <a href="https://gist.github.com/rampadc/6b76bc3c00d94d7ac2cfad9999de737b">examples of report JSONs</a>.</p>

<p>For a Javascript example of how the authentication sequence work, have a look at the <a href="https://github.com/rampadc/toddler-auth">toddler-auth</a> project.</p>

    <h4><a href="https://congx.dev/">Back to Home</a></h4>
</div>


        </div><footer class="container">
    <hr class="soften">
    <p>
        &copy; 
        <a href="congx.dev" target="_blank">
            Cong Nguyen
        </a>
        <span id="thisyear">2020</span>
        
             | Built on <a href="//gohugo.io" target="_blank">Hugo</a>
        
    </p>
    <p class="text-center">
        
        <a href="https://twitter.com/congxdev">Twitter</a> 
        <a href="https://linkedin.com/in/cong-ng">Linkedin</a> 
        <a href="https://github.com/rampadc">GitHub</a> 
        
    </p>
</footer>

<script src="/js/jquery.js"></script>
<script src="/js/bootstrap-386.js"></script>
<script src="/js/bootstrap-transition.js"></script>
<script src="/js/bootstrap-alert.js"></script>
<script src="/js/bootstrap-modal.js"></script>
<script src="/js/bootstrap-dropdown.js"></script>
<script src="/js/bootstrap-scrollspy.js"></script>
<script src="/js/bootstrap-tab.js"></script>
<script src="/js/bootstrap-tooltip.js"></script>
<script src="/js/bootstrap-popover.js"></script>
<script src="/js/bootstrap-button.js"></script>
<script src="/js/bootstrap-collapse.js"></script>
<script src="/js/bootstrap-carousel.js"></script>
<script src="/js/bootstrap-typeahead.js"></script>
<script src="/js/bootstrap-affix.js"></script>
<script>
    _386 = { 
        fastLoad: false ,
        onePass: false , 
        speedFactor: 1.25 
    };

    
    function ThisYear() {
        document.getElementById('thisyear').innerHTML = new Date().getFullYear();
    };
</script></body>
</html>
