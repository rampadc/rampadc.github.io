<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Multi-objective Optimisation with IBM ILOG CPLEX - Part 2 :: congx.dev</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Recap part 1 In part 1, I created some multi-objective optimisation models with OPL using both the CP Optimiser and CPLEX Optimiser. However, I hit a no-documentation barrier when started using the staticLexFull() function and found the DOcplex.mp Python example to be a more readable.
In this post, I&amp;rsquo;ll take a look at first converting the existing weighted model to Python, proceed with adding additional weights to the model and finally expose a nice web GUI to control different variables and view the results." />
<meta name="keywords" content=", " />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://congx.dev/posts/multiobjective-optimisation-with-ibm-ilog-cplex-2/" />


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-35148726-3', 'auto');
	
	ga('send', 'pageview');
}
</script>



<link rel="stylesheet" href="https://congx.dev/assets/style.css">

  <link rel="stylesheet" href="https://congx.dev/assets/light_blue.css">






<link rel="apple-touch-icon" href="https://congx.dev/img/apple-touch-icon-192x192.png">

  <link rel="shortcut icon" href="https://congx.dev/img/favicon/light_blue.png">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Multi-objective Optimisation with IBM ILOG CPLEX - Part 2">
<meta property="og:description" content="In this post, I&#39;ll take a look at first converting the [existing weighted model](https://congx.dev/posts/multiobjective-optimisation-with-ibm-ilog-cplex-1/#much-faster-model-with-weights-cplex-optimizer) in part 1 to Python, proceed with adding additional weights to the model and finally expose a nice web GUI to control different variables and view the results." />
<meta property="og:url" content="https://congx.dev/posts/multiobjective-optimisation-with-ibm-ilog-cplex-2/" />
<meta property="og:site_name" content="congx.dev" />

  <meta property="og:image" content="https://congx.dev/">

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2021-01-04 00:33:00 &#43;1100 &#43;1100" />












</head>
<body class="light_blue">


<div class="container headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Cong&#39;s little blog
  </div>
</a>

    </div>
    
      <div class="menu-trigger">menu</div>
    
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/readme">README</a></li>
        
      
        
          <li><a href="/toc">T.O.C</a></li>
        
      
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/readme">README</a></li>
      
    
      
        <li><a href="/toc">T.O.C</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://congx.dev/posts/multiobjective-optimisation-with-ibm-ilog-cplex-2/">Multi-objective Optimisation with IBM ILOG CPLEX - Part 2</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2021-01-04 
      </span>
    
    
    <span class="post-author">:: Cong Nguyen</span>
    
  </div>

  
  <span class="post-tags">
    
    #<a href="https://congx.dev/tags/toddler/">toddler</a>&nbsp;
    
    #<a href="https://congx.dev/tags/ibm/">ibm</a>&nbsp;
    
  </span>
  

  

  
    <div class="table-of-contents">
      <h2>
        
          Table of Contents
        
      </h2>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#recap-part-1">Recap part 1</a></li>
    <li><a href="#whats-docplex">What&rsquo;s DOcplex?</a></li>
    <li><a href="#code-sample">Code sample</a></li>
    <li><a href="#journey-to-pythonic-cplex">Journey to Pythonic CPLEX</a>
      <ul>
        <li><a href="#rewrite-the-opl-model-in-python">Rewrite the OPL model in Python</a></li>
        <li><a href="#add-weights-with-constraints-in-docplex">Add weights with constraints in docplex</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
  

  <div class="post-content"><div>
        <h2 id="recap-part-1">Recap part 1<a href="#recap-part-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>In <a href="https://congx.dev/posts/multiobjective-optimisation-with-ibm-ilog-cplex-1/">part 1</a>, I created some multi-objective optimisation models with OPL using both the CP Optimiser and CPLEX Optimiser. However, I hit a no-documentation barrier when started using the <code>staticLexFull()</code> function and found the <code>DOcplex.mp</code> Python example to be a more readable.</p>
<p>In this post, I&rsquo;ll take a look at first converting the <a href="https://congx.dev/posts/multiobjective-optimisation-with-ibm-ilog-cplex-1/#much-faster-model-with-weights-cplex-optimizer">existing weighted model</a> to Python, proceed with adding additional weights to the model and finally expose a nice web GUI to control different variables and view the results.</p>
<h2 id="whats-docplex">What&rsquo;s DOcplex?<a href="#whats-docplex" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>DOcplex <a href="https://www.ibm.com/support/knowledgecenter/SSSA5P_12.9.0/com.ibm.docplex.help/DOcplex/topics/DOcplex_home.html">stands for Decision Optimisation CPLEX</a>. It&rsquo;s a Python library composed of two modules:</p>
<ul>
<li><code>docplex.mp</code>: taps into CPLEX Optimiser APIs, <code>mp</code> stands for mathematical programming</li>
<li><code>docplex.cp</code>: taps into CP Optimiser APIs, <code>cp</code> stands for constraint programming</li>
</ul>
<p>The library is advertised to be compatible with panda and numpy. The official documentation for this library is located at <a href="https://ibmdecisionoptimization.github.io/docplex-doc/">IBM Decision Optimisation Github Page</a>. The documentation looks like it was written for someone who&rsquo;s already been using CPLEX, i.e. with a lot of assumed knowledge. Aside from the setup intructions, it goes straight to the examples, and there&rsquo;s only <a href="https://ibmdecisionoptimization.github.io/docplex-doc/mp/nurses_multiobj.html">one</a> multi-opjective optimisation example using the MP variant.</p>
<p>As of January 4th 2021, <code>docplex</code> library package that comes with CPLEX Optimisation Studio v20.1.0 relies on a legacy <code>cplex</code> library that only works with Python 3.8 and below.</p>
<h2 id="code-sample">Code sample<a href="#code-sample" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>The complete code listing for this post will be available in <a href="https://github.com/rampadc/multi-obj-cplex-python">https://github.com/rampadc/multi-obj-cplex-python</a>.</p>
<h2 id="journey-to-pythonic-cplex">Journey to Pythonic CPLEX<a href="#journey-to-pythonic-cplex" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>The Python code will make heavy use of Python&rsquo;s <a href="https://docs.python.org/3.8/tutorial/datastructures.html#list-comprehensions">List Comprehension</a> feature.</p>
<h3 id="rewrite-the-opl-model-in-python">Rewrite the OPL model in Python<a href="#rewrite-the-opl-model-in-python" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>If you&rsquo;re new to OPL and decide to skip part 1, the comments in the code sample below explains the different types of data in OPL. This is the same OPL model that will be rewritten in Python.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c#" data-lang="c#"><span style="color:#75715e">// Defines a set of string named Units. Sets are declared with the {&lt;type&gt;} syntax
</span><span style="color:#75715e"></span>{<span style="color:#66d9ef">string</span>} Units = {<span style="color:#e6db74">&#34;axe&#34;</span>, <span style="color:#e6db74">&#34;light cavalry&#34;</span>, <span style="color:#e6db74">&#34;mounted archer&#34;</span>, <span style="color:#e6db74">&#34;berserker&#34;</span>, <span style="color:#e6db74">&#34;ram&#34;</span>};
<span style="color:#75715e">// Define an array of key-value pairs, where the value is of type int.
</span><span style="color:#75715e">// These are listed in the same order as the keys in Units, i.e., &#34;axe&#34; = 45, &#34;light cavalary&#34; = 130, ...
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> strengths[Units] = [<span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">130</span>, <span style="color:#ae81ff">150</span>, <span style="color:#ae81ff">300</span>, <span style="color:#ae81ff">2</span>];
<span style="color:#75715e">// Define an array of key-value pairs, where the value is of type int.
</span><span style="color:#75715e">// These are listed in the same order as the keys in Units, i.e., &#34;axe&#34; = 90, &#34;light cavalary&#34; = 360, ...
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> recruitTimeInSeconds[Units] = [<span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">360</span>, <span style="color:#ae81ff">450</span>, <span style="color:#ae81ff">1200</span>, <span style="color:#ae81ff">480</span>];
<span style="color:#75715e">// Define an array of key-value pairs, where the value is of type int.
</span><span style="color:#75715e">// These are listed in the same order as the keys in Units, i.e., &#34;axe&#34; = 1, &#34;light cavalary&#34; = 4, ...
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> foodPerUnit[Units] = [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">5</span>];

<span style="color:#75715e">// Define an array of key-value pairs, where the value is of type int.
</span><span style="color:#75715e">// `dvar` signifies this is a decision variable, i.e. the results of your optimisation
</span><span style="color:#75715e">// `int+` signifies the number of units for each key can only be a postive integer
</span><span style="color:#75715e"></span>dvar <span style="color:#66d9ef">int</span>+ numberOfUnits[Units];

<span style="color:#75715e">// Decision Expressions is a way to name computing epxressions. It makes the code easier to read.
</span><span style="color:#75715e">// total build time is an integer. sum(u in Units) is like a single-line foreach loop. 
</span><span style="color:#75715e"></span>dexpr <span style="color:#66d9ef">int</span> totalBuildTime = sum(u <span style="color:#66d9ef">in</span> Units) (numberOfUnits[u] * recruitTimeInSeconds[u]);
<span style="color:#75715e">// total negative attack strength time is an integer. 
</span><span style="color:#75715e">// It&#39;s being negated because CPLEX can only maximise or minimise the computing expressions. 
</span><span style="color:#75715e"></span>dexpr <span style="color:#66d9ef">int</span> totalNegativeAttackStrength = -(sum(u <span style="color:#66d9ef">in</span> Units) (numberOfUnits[u] * strengths[u]));
<span style="color:#75715e">// total food is the sum of of all the provisions taken up by all the units
</span><span style="color:#75715e"></span>dexpr <span style="color:#66d9ef">int</span> totalFood = sum(u <span style="color:#66d9ef">in</span> Units) (numberOfUnits[u] * foodPerUnit[u]);

<span style="color:#75715e">// the goal defines a list of decision expressions we&#39;re optimising.
</span><span style="color:#75715e">// in this definition, I&#39;m optimising for the negated total attack strength and the total build time
</span><span style="color:#75715e">// 1..2 is a range from 1 to 2 inclusively
</span><span style="color:#75715e">// int in the goals doesn&#39;t have any significance
</span><span style="color:#75715e"></span>dexpr <span style="color:#66d9ef">int</span> goals[i <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.<span style="color:#ae81ff">2</span>] = (i == <span style="color:#ae81ff">1</span>) ? totalNegativeAttackStrength : totalBuildTime;
<span style="color:#75715e">// while setting them to the same priority. This is also called a blended optimisation.
</span><span style="color:#75715e">// the difference here is using CP Optimiser, you have to define the priorities of the goals
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> priorities[i <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.<span style="color:#ae81ff">2</span>] = <span style="color:#ae81ff">1</span>;

<span style="color:#75715e">// the weight is an array of floating point numbers.
</span><span style="color:#75715e">// the ... on the right means it&#39;s loading the data from an external data file.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">float</span> weights[<span style="color:#ae81ff">1.</span>.<span style="color:#ae81ff">2</span>] = ...; <span style="color:#75715e">// weight[1]: strength, weight[2]: time
</span><span style="color:#75715e">// the absolute and relative tolerances - I have absolutely no idea what they do, but they are required
</span><span style="color:#75715e">// Assigning abstol and reltol to 0 doesn&#39;t seem to have an impact on the solution
</span><span style="color:#75715e"></span><span style="color:#66d9ef">float</span> abstol[i <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.<span style="color:#ae81ff">2</span>] = <span style="color:#ae81ff">0</span>; 
<span style="color:#66d9ef">float</span> reltol[i <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1.</span>.<span style="color:#ae81ff">2</span>] = <span style="color:#ae81ff">0</span>; 

<span style="color:#75715e">// Objective - always need to be placed before the constraints
</span><span style="color:#75715e">// Minimising all objectives using the staticLexFull function, it requires CPLEX Optimiser to run
</span><span style="color:#75715e"></span>minimize staticLexFull(goals, weights, priorities, abstol, reltol);

<span style="color:#75715e">// Constraints
</span><span style="color:#75715e">// and some constraints
</span><span style="color:#75715e"></span>subject to {
  <span style="color:#75715e">// this is where decision expressions come in handy
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// ctFoodNoChurch and ctMustHaveRams are constraints labels
</span><span style="color:#75715e"></span>  ctFoodNoChurch: <span style="color:#ae81ff">20580</span> &lt;= totalFood &lt;= <span style="color:#ae81ff">20596</span>;
  ctMustHaveRams: numberOfUnits[<span style="color:#e6db74">&#34;ram&#34;</span>] &gt;= <span style="color:#ae81ff">250</span>;
  <span style="color:#75715e">// constraints don&#39;t need to have labels
</span><span style="color:#75715e"></span>  <span style="color:#ae81ff">0</span> &lt; totalBuildTime &lt;= <span style="color:#ae81ff">4</span> * <span style="color:#ae81ff">7</span> * <span style="color:#ae81ff">24</span> * <span style="color:#ae81ff">3600</span>; <span style="color:#75715e">// recruit time is in seconds, 4 weeks, 7 days/week, 24 hours/day, 3600 seconds/hour
</span><span style="color:#75715e"></span>}
</code></pre></div><p>In this exercise, I&rsquo;m using Jupyter Notebook to learn docplex. GitHub can format a IPython notebook much better than Hugo can. To see the result, visit <a href="https://github.com/rampadc/multi-obj-cplex-python/blob/master/01-minimize-staticLex.ipynb">01-minimize-staticLex.ipynb</a></p>
<p><strong>GIF frasier wait a minute</strong></p>
<p>&ldquo;<code>staticLex</code> in the filename? Not staticLexFull?&rdquo; Yea&hellip; doesn&rsquo;t look like docplex has the same capabilities as OPL, but the code sure does look nice doesn&rsquo;t it. I suppose we&rsquo;ll have to make these weights into constraints.</p>
<h3 id="add-weights-with-constraints-in-docplex">Add weights with constraints in docplex<a href="#add-weights-with-constraints-in-docplex" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

      </div></div>

  
  
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        
        <span class="button next">
            <a href="https://congx.dev/posts/multiobjective-optimisation-with-ibm-ilog-cplex-1/">
                <span class="button__text">Multi-objective Optimisation with IBM ILOG CPLEX - Part 1</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2021 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="https://congx.dev/assets/main.js"></script>
<script src="https://congx.dev/assets/prism.js"></script>







  
</div>

</body>
</html>
